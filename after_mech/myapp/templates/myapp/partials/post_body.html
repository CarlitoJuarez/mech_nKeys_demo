{% load static %}

{# templates/myapp/partials/post_body.html #}

<div class="post_wrapper flip {% if forloop.first %}first_one{% elif forloop.last %}last_one{% endif %}" id="{{ post.id }}" value="{{ post.rendering_id }}">
  {% if request.user == post.user %}
    <div class="post_div delete_field back hide">
      <p>Are you sure you want to delete this post?</p>
      <div class="delete_dec">
        <button class="post_btn delete_yes">Yes</button>
        <button class="post_btn delete_no">No</button>
      </div>
    </div>
  {% endif %}
    <div id="post_div_{{ post.rendering_id }}" class="post_div front">
      <div id="{{ post.image.count }}" class="post_img {{ post.rendering_id }}">

        <button type="button" class="prev_button add_post_prev_img post_prev post_prev_{{post.rendering_id}}">
          <img style="position: absolute; width: 3rem; top: 42%; left: -13px; border-radius: 20px" src="{% static 'imgs/post_arrow.png' %}">
        </button>

        <button type="button" class="next_button add_post_next_img post_next post_next_{{post.rendering_id}}">
            <img style="position: absolute; width: 3rem; top: 42%; right: -3px; border-radius: 20px;" src="{% static 'imgs/arrow_right.png' %}">
        </button>

        {% if post.description %}
          <button type="button" class="descr_button add_post_next_img post_descr post_descr_{{post.rendering_id}}">
              <img style="position: relative; width: 3rem; border-radius: 20px;" src="{% static 'imgs/post_arrow.png' %}">
          </button>
        {% endif %}
        
        <img class="edit_bin post_bin hide" src="{% static 'imgs/bin.png' %}">

        <label class="img_warning hide">
          NOTE: only 9 pictures allowed.
        </label>

        {% if request.user == post.user %}
          <label class="small_btn plus_button plus_label edit_imgs_btn hide">
            <img class="plus_img" src="{% static 'imgs/plus.png' %}">
            <input name="images" class="image_input files_id" type="file" multiple required style="display:none;">
          </label>
        {% endif %}

        <div class='post_descr_div descr_div_{{post.rendering_id}}'>
          <p class='post_descr_content show'>{{ post.description }}</p>
          <div class='edit_descr_wrapper hide'>
            <textarea class='description edit_descr' maxlength=600>{{post.description}}</textarea>
          </div>
        </div>
        <div class="post_slide_show slide_show_{{post.rendering_id}}">
          {% for img in post.images.all %}
          <img style='display: block' src="{{img.image.url}}" name="{{ img.id }}" alt="{{ post.product_name }}" id="img_{{ forloop.counter0 }}" class="img {{post.images.count}} {{post.rendering_id}} img_{{img.id}} img_rend_{{post.rendering_id}} create_image">
          {% endfor %}
        </div>
      </div>
      <div id="post_info_{{post.rendering_id}}" class="post_info">
        <div class="span_info">
          <p class="info_post_item" type="text" name="name" id="post_info_product_name">{{ post.name }}</p>
          <div class="info_wrapper">
            <div class="post_label_product">
                <p>Brand</p>
                <p>Category</p>

                <!-- KEYBOARD -->
                {% if post.category == "Keyboard" %}
                <p style="display: block;">Layout</p>
                {% endif %}

                <p>Color</p>

                <!-- KEYCAPS -->
                {% if post.category == "Keycaps" %}
                <p style="display: block;">Material</p>
                {% endif %}


                <!-- SWITCHES -->
                {% if post.category == "Switches" %}
                <p style="display: block;">Type</p>
                <p style="display: block;">Amount</p>
                <p style="display: block;">Lubed</p>
                {% endif %}

                <!-- KEYBOARD -->
                {% if post.category == "Keyboard" %}
                  <p  class='post_switches_label 
                    {% if post.keyboard.switches %}
                    show
                    {% else %}
                    hide
                    {% endif %}
                  '>Switches</p>
                  <p class='post_keycaps_label
                    {% if post.keyboard.keycaps %}
                    show
                    {% else %}
                    hide
                    {% endif %}
                  '>Keycaps</p>
                  {% if post.keyboard.mount %}
                    <p>Mounting</p>
                  {% endif %}
                {% endif %}

                <p class="for_sale">For Sale</p>

                <p class="post_price_label
                {% if post.for_sale == True %}show{% else %}hide{% endif %}">Price
                  <span class="tooltip">?
                    <span class="tooltip_info">Price in USD.</span>
                  </span>
                </p>
            </div>
            <!--<hr style="margin-bottom:.6rem;">-->
            <div class="post_info_product">

              <p class="info_post_item" name="brand" id="brand">{{ post.brand }}</p>
              <p class="info_post_item" name="category" id="category">{{post.category}}</p>

              {% if post.category == "Keyboard" %}
                <p class="info_post_item" name="layout" id="layout">{{post.keyboard.layout}}</p>
              {% endif %}
              <p class="info_post_item" name="color" id="color">{{post.color}}</p>

              <!-- KEYBOARD -->
              {% if post.category == "Keyboard" %}

                <p class="info_post_item 
                  {% if post.keyboard.switches %}
                    show
                  {% else %}
                    hide
                  {% endif %}
                " name="switches" id="switches">{{ post.keyboard.switches }}</p>

                <p class="info_post_item 
                {% if post.keyboard.keycaps %}
                  show
                {% else %}
                  hide
                {% endif %}
                " name="keycaps" id="keycaps">{{ post.keyboard.keycaps }}</p>

              <!-- INPUT --> 
                {% if request.user == post.user %}
                  <input class="info_product_item edit_input edit_switches hide" type="text" name="switches" placeholder="___" maxlength="20" value="{{ post.keyboard.switches }}">
                  <input class="info_product_item edit_input edit_keycaps hide" type="text" name="keycaps" placeholder="___" maxlength="20" value="{{ post.keyboard.keycaps }}">
                {% endif %}

                {% if post.keyboard.mount %}
                  <p class="info_post_item m_style_{{post.rendering_id}}" id="mount">{{ post.keyboard.mount }}</p>
                {% endif %}

              {% endif %}


              <!-- SWITCHES -->
              {% if post.category == "Switches" %}
                <p class="info_post_item"  name="s_type" id="s_type">{{ post.switches.type }}</p>
                <p class="info_post_item show" name="s_amount" id="s_amount">{{ post.switches.amount }}</p>
                {% if request.user == post.user %}
                  <input class="info_product_item edit_input edit_s_amount hide" type="number" inputmode="decimal" min="10" max="999" step="1" name="edit_s_amount" placeholder="{{ post.switches.amount }}">
                {% endif %}
                <p class="info_post_item s_lubed show">{% if post.switches.lubed %}Yes{% else %}No{% endif %}</p>
                {% if request.user == post.user %}
                  <input class="info_post_item edit_input edit_checkbox edit_s_lubed hide" type="checkbox" name="s_lubed">
                {% endif %}
              {% endif %}

              <!-- KEYCAPS -->
              {% if post.category == "Keycaps" %}
              <p class="info_post_item k_material_{{post.rendering_id}}" name="k_material">{{ post.keycaps.material }}</p>
              {% endif %}

              <!-- FORSALE -->
              {% if post.for_sale == True %}
                <p class="info_post_item sale_label post_for_sale show" name="for_sale" id="for_sale">Yes</p>
              {% else %}
                <p class="info_post_item sale_label post_for_sale show" name="for_sale" id="for_sale">No</p>
              {% endif %}
              {% if request.user == post.user %}
                <input class="info_post_item edit_input edit_checkbox edit_for_sale hide" type="checkbox" name="for_sale">
              {% endif %}
              <p class="info_post_item post_price {% if post.for_sale == True %}show{% else %}hide{% endif %}" name="price" value="{{ post.price }}">{{ post.price }}</p>
              {% if request.user == post.user %}
                <input class="info_post_item_input edit_input edit_price hide" type="number" inputmode="numeric" max="9999" min="10" step="1.0" name="price" placeholder="{{ post.price }}">
              {% endif %}
            </div>
          </div>
        </div>
        <div class="post_stamp {% if request.user == post.user %}post_owned{% endif %}">
          {% if post.user == request.user %}
            <button id={{ post.id }} class="delete_btn post_btn hide">DELETE</button>
          {% endif %}
          <button class="profile_btn post_btn show" value={{post.user}}>
              {{ post.user }}
          </button>
          <div class='like_div'>
            {% if post.likes > 0 %}
            <p class="like_count">{{ post.likes.count }}</p>
            {% endif %}
            {% if post.user == request.user %}
              <p>{{ post.likes.count }}</p>
              <img class="own_heart hearted show" src="{% static 'imgs/heart_b.png'%}">
            {% else %}
              <p class="like_count">{{ post.likes.count }}</p>
              <button id={{ post.id }} class="like_btn">
                {% if request.user in post.likes.all %}
                <img class="heart_me hide" src="{% static 'imgs/heart.png'%}">
                <img class="hearted show" src="{% static 'imgs/heart_b.png'%}">
                {% else %}
                <img class="heart_me show" src="{% static 'imgs/heart.png'%}">
                <img class="hearted hide" src="{% static 'imgs/heart_b.png'%}">
              {% endif %}
              </button>
            {% endif %}
          </div>
        </div>
        <p class="post_date">{{ post.created_at }}</p>
      </div>
      {% if request.user == post.user %}
        <button class="post_btn edit_btn mode_off">
          <img src="{% static 'imgs/settings.png'%}">
        </button>
      {% endif %}
    </div>
    <button class="post_chat_btn">
      <img src="{% static 'imgs/arrow_right.png' %}">
    </button>
  </div>
  <div class="comment_section" id="comment_section">
    <div class="comment_wrapper">
      <div class="comment_area comment_center">
          <textarea id="comment_input{{post.id}}" class="comment_input" maxlength="600" placeholder="_ _ _"></textarea>
          <label id="submit_comment{{post.id}}" class="submit_comment"><img class="submit_comment_img" src="{% static 'imgs/arrow_right.png' %}"></label>
      </div>
      <div class="comment_section_2" id="comment_section_2{{ post.id }}">
        {% if post.comments.first == none %}
          <p class="no_comment" style="text-align: center;">No comments.</p>
        {% else %}
          {% for comment in post.comments.all|dictsortreversed:"id" %}
          <div class="comment_elem {% if comment.user == request.user %}own_comment{% elif comment.user == post.user %}owned_by_comment{% endif %}" id="{{ comment.id }}">
              {% if comment.is_today %}
                <p class="comment_date comment_date_desktop show">Today, {{ comment.date|time:"H:i" }}</p>
              {% else %}
                <p class="comment_date comment_date_desktop show">{{ comment.date|date:"M d, Y" }}</p>
              {% endif %}
              <div class="comment_info">
                <p class="comment_content">{{ comment.content }}</p>
                {% if request.user == comment.user %}
                <textarea class="edit_comment_input hide" type="text" maxlength="600" value="{{ comment.content }}">{{ comment.content }}</textarea>
                {% endif %}
                <a href="{% url 'myapp:profile' comment.user.username %}" class="comment_user">{{ comment.user }}</a>
                {% if comment.is_today %}
                  <p class="comment_date comment_date_tablet hide">Today, {{ comment.date|time:"H:i" }}</p>
                {% else %}
                  <p class="comment_date comment_date_tablet hide">{{ comment.date|date:"M d, Y" }}</p>
                {% endif %}
                {% if request.user == comment.user %}
                <label class="comment_edit">
                  ...
                </label>
                <div class="comment_edit_div hide">
                  <label class="edit_comment">Edit</label>
                  <label class="delete_comment">Delete</label>
                </div>
                <button class="post_btn comment_edit_submit hide">
                  <img class="" src="{% static 'imgs/correct.png' %}">
                </button>
                <button class="post_btn comment_delete_submit hide">
                  <img class="" src="{% static 'imgs/remove.png' %}">
                </button>
                {% endif %}
              </div>
            </div>
          {% endfor %}
        {% endif %}
      </div>
    </div>
    <div class='resizer'></div>
  </div>
